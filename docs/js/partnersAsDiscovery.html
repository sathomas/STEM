<!DOCTYPE html>

<html>
<head>
  <title>partnersAsDiscovery.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="contents.html">
                contents.js
              </a>
            
              
              <a class="source" href="groups.html">
                groups.js
              </a>
            
              
              <a class="source" href="memberGroups.html">
                memberGroups.js
              </a>
            
              
              <a class="source" href="pois.html">
                pois.js
              </a>
            
              
              <a class="source" href="principals.html">
                principals.js
              </a>
            
              
              <a class="source" href="proposals.html">
                proposals.js
              </a>
            
              
              <a class="source" href="searchFilters.html">
                searchFilters.js
              </a>
            
              
              <a class="source" href="subGroups.html">
                subGroups.js
              </a>
            
              
              <a class="source" href="tags.html">
                tags.js
              </a>
            
              
              <a class="source" href="style-helpers.html">
                style-helpers.js
              </a>
            
              
              <a class="source" href="utils.html">
                utils.js
              </a>
            
              
              <a class="source" href="index.html">
                index.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="admins.html">
                admins.js
              </a>
            
              
              <a class="source" href="content.html">
                content.js
              </a>
            
              
              <a class="source" href="discovery.html">
                discovery.js
              </a>
            
              
              <a class="source" href="group.html">
                group.js
              </a>
            
              
              <a class="source" href="partners.html">
                partners.js
              </a>
            
              
              <a class="source" href="poi.html">
                poi.js
              </a>
            
              
              <a class="source" href="principal.html">
                principal.js
              </a>
            
              
              <a class="source" href="proposal.html">
                proposal.js
              </a>
            
              
              <a class="source" href="search.html">
                search.js
              </a>
            
              
              <a class="source" href="searchFilter.html">
                searchFilter.js
              </a>
            
              
              <a class="source" href="searchGroup.html">
                searchGroup.js
              </a>
            
              
              <a class="source" href="tag.html">
                tag.js
              </a>
            
              
              <a class="source" href="tagSet.html">
                tagSet.js
              </a>
            
              
              <a class="source" href="teacherSearch.html">
                teacherSearch.js
              </a>
            
              
              <a class="source" href="teachers.html">
                teachers.js
              </a>
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="adminsAsDiscovery.html">
                adminsAsDiscovery.js
              </a>
            
              
              <a class="source" href="discoveryAsContent.html">
                discoveryAsContent.js
              </a>
            
              
              <a class="source" href="oaeAsMainSearchGroup.html">
                oaeAsMainSearchGroup.js
              </a>
            
              
              <a class="source" href="oaeAsMainSearchResult.html">
                oaeAsMainSearchResult.js
              </a>
            
              
              <a class="source" href="oaeAsMainSearchResults.html">
                oaeAsMainSearchResults.js
              </a>
            
              
              <a class="source" href="oaeAsSecondarySearchGroup.html">
                oaeAsSecondarySearchGroup.js
              </a>
            
              
              <a class="source" href="oaeAsSecondarySearchResult.html">
                oaeAsSecondarySearchResult.js
              </a>
            
              
              <a class="source" href="oaeAsSecondarySearchResults.html">
                oaeAsSecondarySearchResults.js
              </a>
            
              
              <a class="source" href="oaeAsSpotlightItem.html">
                oaeAsSpotlightItem.js
              </a>
            
              
              <a class="source" href="oaeAsSpotlightList.html">
                oaeAsSpotlightList.js
              </a>
            
              
              <a class="source" href="partnersAsDiscovery.html">
                partnersAsDiscovery.js
              </a>
            
              
              <a class="source" href="poiAsMarker.html">
                poiAsMarker.js
              </a>
            
              
              <a class="source" href="poisAsMap.html">
                poisAsMap.js
              </a>
            
              
              <a class="source" href="searchAsForm.html">
                searchAsForm.js
              </a>
            
              
              <a class="source" href="searchFilterAsItem.html">
                searchFilterAsItem.js
              </a>
            
              
              <a class="source" href="searchFiltersAsList.html">
                searchFiltersAsList.js
              </a>
            
              
              <a class="source" href="tagAsCheckbox.html">
                tagAsCheckbox.js
              </a>
            
              
              <a class="source" href="tagSetAsCheckboxGroup.html">
                tagSetAsCheckboxGroup.js
              </a>
            
              
              <a class="source" href="tagSetAsInlineCheckboxGroup.html">
                tagSetAsInlineCheckboxGroup.js
              </a>
            
              
              <a class="source" href="tagsAsCheckboxes.html">
                tagsAsCheckboxes.js
              </a>
            
              
              <a class="source" href="teacherSearchAsPage.html">
                teacherSearchAsPage.js
              </a>
            
              
              <a class="source" href="teachersAsDiscovery.html">
                teachersAsDiscovery.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>partnersAsDiscovery.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*global Stem, _, $, Backbone, JST */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Backbone view for the partners block of the
landing page’s discovery section. Because
that section includes some static content
(to support users without JavaScript), this
isn’t exactly a traditional view. Instead
of rendering everything from whole cloth
via a template, we’ll surgically update
pieces of the static page with dynamic
content.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
Stem.Views = Stem.Views || {};

(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
<span class="hljs-pi">    'use strict'</span>;

    Stem.Views.PartnersAsDiscovery = Backbone.View.extend({

        template: JST[<span class="hljs-string">'app/scripts/templates/partnersAsDiscovery.ejs'</span>],

        tagName: <span class="hljs-string">'article'</span>,

        className: <span class="hljs-string">'discovery'</span>,

        id: <span class="hljs-string">'partners'</span>,

        initialize: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Build the tag set that controls display of
organizations (schools and businesses). Note
that we’re adding an additional attribute
to the Tag models, namely the class of the
POI marker corresponding to the tag. We
use that class to adjust the visibility
of the markers based on how the user
interacts with the filters.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.tagSet = <span class="hljs-keyword">new</span> Stem.Models.TagSet({
                tags:   <span class="hljs-keyword">new</span> Stem.Collections.Tags([
                            <span class="hljs-keyword">new</span> Stem.Models.Tag({
                                label: <span class="hljs-string">'Schools'</span>,
                                selected: <span class="hljs-literal">true</span>,
                                theme: <span class="hljs-string">'theme-3-light'</span>,
                                poiClass: <span class="hljs-string">'poi-school'</span>
                            }),
                            <span class="hljs-keyword">new</span> Stem.Models.Tag({
                                label: <span class="hljs-string">'Businesses'</span>,
                                selected: <span class="hljs-literal">true</span>,
                                theme: <span class="hljs-string">'theme-3'</span>,
                                poiClass: <span class="hljs-string">'poi-business'</span>
                            }),
                            <span class="hljs-keyword">new</span> Stem.Models.Tag({
                                label: <span class="hljs-string">'Organizations'</span>,
                                selected: <span class="hljs-literal">true</span>,
                                theme: <span class="hljs-string">'theme-3-dark'</span>,
                                poiClass: <span class="hljs-string">'poi-organization'</span>
                            })
                        ]),
                title:  <span class="hljs-string">'I’m looking for'</span>
            });

        },

        render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Normally this view is used to “fill in”
components that already exist on a static
page. When that’s the case, we will have
been provided an element that already has
content. To be safe, though, we check to
make sure that content is present. If it
isn’t we use our template as a starting
point.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$el.is(<span class="hljs-string">':empty'</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>We don’t need to supply any
attributes to the view since
it’s just a static skeleton.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                <span class="hljs-keyword">this</span>.$el.html(<span class="hljs-keyword">this</span>.template());

            }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Add the ARIA attributes for accessibility</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">var</span> headingId = _.uniqueId();
            <span class="hljs-keyword">this</span>.$el.attr(<span class="hljs-string">'aria-labelledby'</span>, headingId);
            <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">'h3'</span>).attr(<span class="hljs-string">'id'</span>, headingId);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Create and render the child views.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">new</span> Stem.Views.TagSetAsInlineCheckboxGroup({
                el: <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">'#partners-organizations-filter'</span>),
                model: <span class="hljs-keyword">this</span>.tagSet
            }).render();

            <span class="hljs-keyword">new</span> Stem.Views.PoisAsMap({
                el: <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">'#partners-organizations-map'</span>),
                collection: <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'organizationPois'</span>),
                tintUrl: <span class="hljs-string">'images/theme-3-background.png'</span>
            }).render().show();

            <span class="hljs-keyword">new</span> Stem.Views.PoisAsMap({
                el: <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">'#partners-donorschoose-map'</span>),
                collection: <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'proposalPois'</span>),
                tintUrl: <span class="hljs-string">'images/theme-3-background.png'</span>
            }).render().show();

            <span class="hljs-keyword">new</span> Stem.Views.OaeAsSpotlightList({
                el: <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">'#partners-spotlights'</span>),
                collection: <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'partnerships'</span>)
            }).render();</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>If the spotlight list isn’t empty, we’ll
want to show it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            
            <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'partnerships'</span>), <span class="hljs-string">'add'</span>, <span class="hljs-keyword">this</span>.showSpotlights);
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'partnerships'</span>).length) {
                <span class="hljs-keyword">this</span>.showSpotlights();
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Respond to changes in the tag set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>.tagSet.get(<span class="hljs-string">'tags'</span>), <span class="hljs-string">'change'</span>, <span class="hljs-keyword">this</span>.updateFilters);

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>; <span class="hljs-comment">// for method chaining.</span>

        },
        
        showSpotlights: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            
            <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">'.spotlight-block'</span>).removeClass(<span class="hljs-string">'util--hide'</span>);
            
        },

        updateFilters: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>If the user changes the selection
of one of the tag filters, we
update the map to the user’s
preference. Go through our
set of tags to get the selection
state of each.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.tagSet.get(<span class="hljs-string">'tags'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tag)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Set the <code>data-hidden</code> attribute
of the markers appropriately.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                $(<span class="hljs-string">'#partners-organizations-map'</span>)
                    .find(<span class="hljs-string">'.'</span> + tag.get(<span class="hljs-string">'poiClass'</span>))
                    .attr(<span class="hljs-string">'data-hidden'</span>,
                        tag.get(<span class="hljs-string">'selected'</span>) ? <span class="hljs-string">'0'</span> : <span class="hljs-string">'1'</span>
                    );

            });

        }

    });

})();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
